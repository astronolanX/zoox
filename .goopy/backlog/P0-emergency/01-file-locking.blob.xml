<blob type="thread" scope="project" status="active" updated="2026-01-08" v="2">
  <summary>Implement file locking for write operations</summary>
  <context>
    Multiple Claude sessions or agents writing to same blob can cause data loss.
    Path.write_text() provides no locking mechanism. Need to implement advisory
    locking via fcntl.flock() or atomic write pattern.
    Confidence: 0.95 (verified in code review).
  </context>
  <files>
    <file>src/goopy/blob.py</file>
  </files>
  <decisions>
    <decision why="Cross-platform compatibility">Use atomic write pattern (temp + rename) over fcntl</decision>
  </decisions>
  <facts>
    <fact>Severity: CRITICAL</fact>
    <fact>Confidence: 0.95</fact>
    <fact>Effort: 1-2 days</fact>
    <fact>Location: blob.py:220-223</fact>
  </facts>
  <next>
    <step>Create atomic_write helper function</step>
    <step>Update Blob.save() to use atomic_write</step>
    <step>Add test for concurrent write safety</step>
  </next>
  <related>
    <ref>02-path-validation</ref>
    <ref>03-archive-uniqueness</ref>
  </related>
</blob>
